<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>PikiwiDB(Pika) Blog</title>
        <link>https://www.pikiwidb.com/blog</link>
        <description>PikiwiDB(Pika) Blog</description>
        <lastBuildDate>Mon, 08 Jul 2024 00:00:00 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>zh-Hans</language>
        <item>
            <title><![CDATA[What's new in PikiwiDB(Pika) v4.0.0]]></title>
            <link>https://www.pikiwidb.com/blog/PikiwiDB-Pika--4.0.0</link>
            <guid>https://www.pikiwidb.com/blog/PikiwiDB-Pika--4.0.0</guid>
            <pubDate>Mon, 08 Jul 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[尊敬的社区成员及技术爱好者们：]]></description>
            <content:encoded><![CDATA[<p>尊敬的社区成员及技术爱好者们：
PikiwiDB 社区荣耀地宣告——经过 9 个月打磨并在生产环境稳定运行 5 个月的 PikiwiDB(Pika) v4.0.0 【下文简称 Pika】今天正式发布。希望基于第三代存储引擎 Floyd 的这个新版本能为社区用户们带来更卓越的体验。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-重大改进">1 重大改进<a class="hash-link" aria-label="1 重大改进的直接链接" title="1 重大改进的直接链接" href="https://www.pikiwidb.com/blog/PikiwiDB-Pika--4.0.0#1-%E9%87%8D%E5%A4%A7%E6%94%B9%E8%BF%9B">​</a></h2>
<p>1.1 第三代存储引擎 Floyd
Floyd 如同其前代 Blackwidow，基于 RocksDB，不仅支持基础的 String 结构，也原生支持了 Hash、List、Set、Stream及 ZSet 等 KKV 形式的复合数据结构。</p>
<ul>
<li>RocksDB 实例数可配置</li>
</ul>
<p>摒弃了 Blackwidow 按数据类型采用 RocksDB 实例的物理隔离模式，Floyd 采用了 RocksDB 的 Column-Family 虚拟隔离机制，在单个 RocksDB 实例下可存储所有类型的数据。用户可自由设定 Pika 实例中每个 DB【等同于Redis DB】中 RocksDB 实例的数量，而数据的存储则依据 key 的 hash 值分配至相应的 RocksDB 实例，减小了数据的空间放大和读放大效应，实现了机器资源的高效利用。</p>
<ul>
<li>禁止重复 key</li>
</ul>
<p><img decoding="async" loading="lazy" alt="2024-05-16-PikiwiDB(Pika)-4.0.0-key" src="https://www.pikiwidb.com/assets/images/2024-07-08-PikiwiDB(Pika)-4.0.0-key-357e46564ca61e525f598aa7ac52b886.png" width="1080" height="1006" class="img_ev3q">
基于 RocksDB 的 Column-Family 虚拟隔离机制，Floyd 把所有类型的 key 和 string 一起存储在 Column-Family 0。在此存储基础之上，可明确禁止不同类型的 key 重复，这一设计旨在杜绝潜在的数据冗余与不一致性，与 Redis 服务特性保持一致，进一步提升了系统的整体效率与数据质量。</p>
<ul>
<li>Floyd 详细说明</li>
</ul>
<p>如果对 Floyd 存储引擎感兴趣，请详阅《Floyd 存储引擎》【链接：<a href="https://github.com/OpenAtomFoundation/pika/discussions/2052%E3%80%91%E3%80%82%E7%94%B1%E4%BA%8E" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/discussions/2052】。由于</a> Floyd 前后进行了多个版本的迭代，所以阅读该 github discussion 文档时请注意前后时间，如有相关冲突性说法，以最新日期的文字为准。</p>
<p>关键 PR：</p>
<ul>
<li>PikiwiDB(Pika)  支持 Floyd 存储引擎<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2413" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2413</a></li>
<li>添加 Floyd 的 compaction-filter 的 Gtest<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2669" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2669</a></li>
<li>Pika 不支持不同类型的重复 key, 写入重复 key 返回非法类型<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2609" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2609</a></li>
<li>对 HyperLogLog 和 String 进行类型隔离，确保 HyperLogLog 操作与 String 操作明确区分开<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2720" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2720</a></li>
<li>添加支持分区索引过滤的功能<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2601" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2601</a></li>
</ul>
<p>1.2 Mget 批量查询缓存</p>
<p>Pika v3.5.2 的热数据缓存只实现了对热点 Key 的点查(如get/hget)，在后续的 v3.5.3 和 v3.5.4 修复若干 bug 后，对热数据的点查目前已经非常稳定。然而并未支持批量查询(如 mget etc)。
内部业务侧反馈批量查询速度比较慢，在 40C/256GiB/2TiB SATA SSD 规格机器上数据量超过 100GiB 时，Pika v3.3.6 30% 批量查询延迟超过 35ms。但由于 Pika 热数据缓存尚未支持批量查询，性能并未改善。</p>
<p>为了满足业务需求，Pika 团队开发了批量查询热数据缓存功能，显著提升了批量查询性能，降低了查询延迟和失败率。相关技术细节请阅读《PikiwiDB (Pika) 混合存储之批量查询》 【链接：<a href="https://mp.weixin.qq.com/s/KFLPruSdB66TMRxUfR9PbQ" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/s/KFLPruSdB66TMRxUfR9PbQ</a> 】。</p>
<p>关键 PR ：</p>
<ul>
<li>Mget 支持多 key 查询缓存, 记录未命中的 key 去 DB 中查询，提升 Pika 服务的读性能<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2675" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2675</a></li>
<li>修复 Mget 没有使用解析 ttl 的函数导致出现部分key的ttl未被更新，数据不一致的问题<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2730" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2730</a></li>
</ul>
<p>1.3 主从复制</p>
<p>Pika v3.3.6 有很多主从复制的缺陷。v4.0.0 版本对 Pika 全量复制及增量复制进行了大量优化和 bug 修复，取得了非常好的效果。
并在 info 命令中输出了 "repl_connect_status" 指标(PR 2638)，以方便用户更加明确清晰的确定当前的主从复制状态。</p>
<p>关键 PR ：</p>
<ul>
<li>修复批量扩容时，多个 slave 同时连接 master, 短时间多次 bgsave 导致部分从节点数据不完整的问题<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2746" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2746</a></li>
<li>修复 Spop 在写 binlog 时可能会出现竞态问题<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2647" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2647</a></li>
<li>修复多 DB 下全量同步超时后不重试的问题<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2667" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2667</a></li>
<li>修复多 DB 主从超时场景下，可能会出现窗口崩溃的问题<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2666" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2666</a></li>
<li>修复主从同步限速逻辑中重复解锁的问题<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2657" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2657</a></li>
<li>重构主从复制模式 slave 节点的主从同步线程模型，尽可能减少 binlog 消费阻塞问题<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2638" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2638</a></li>
</ul>
<p>1.4 Redis Stream</p>
<p>Redis Stream 类似于消息队列（MQ），以便更安全地传递消息。为了确保数据的安全性，底层引擎 BlackWidow 和 Floyd 中特别添加了对 Stream 数据类型的支持。
关键 PR：</p>
<ul>
<li>修复 pkpatternmatchdel 命令使用错误导致的 stream 类型数据删除异常的问题<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2726" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2726</a></li>
<li>修复 Keyspace 命令未计算 Stream 类型数据的问题<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2705" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2705</a></li>
</ul>
<p>1.5 Compaction</p>
<p>PikiwiDB(Pika) 的底层磁盘存储引擎 RocksDB 在进行 compaction 时会显著影响 PikiwiDB(Pika) 的读写性能。因此，控制好 compaction 是优化 Pika 读写性能的关键。</p>
<p>Floyd 使用了 v8.7.3 版本的 RocksDB，开放了更多 RocksDB 参数，以方便用户优化 RocksDB 性能：</p>
<ul>
<li>enable-partitioned-index-filters： 支持加载分区索引过滤器，加快 RocksDB 查找速度。</li>
<li>min-write-buffer-number-to-merge: 默认值为 1，如果将此值设置得更大，意味着需要更多的写缓冲区被填满后才进行 flush。这样可以减少 flush 的频率，增加数据在内存中的累积量，从而可能提高写入吞吐量。</li>
<li>level0-stop-writes-trigger: 默认值为 36，定义了 L0 层中 sst 文件的最大数量，一旦达到这个数量，RocksDB 将会采取 暂停写入、强制 compaction 等措施来防止写入操作继续累积，以避免 L0 层变得过于庞大，进而可能导致写入放大、查询性能下降等问题。</li>
<li>level0-slowdown-writes-trigger：默认值为 20，用于控制当 Level 0 的 SST 文件数量达到这个阈值时，触发写减速（write slowdown），防止 Level 0 的文件数量过多，导致后续 compaction 操作的压力过大。</li>
<li>level0-file-num-compaction-trigger：默认值为 4，当 Level 0 的 SST 文件数量达到这个参数设定的阈值时，RocksDB 会开始执行 compaction 操作，将 Level 0 的文件合并到 Level 1，以减少 Level 0 的文件数量，降低读取延迟，并优化存储空间的利用率。</li>
<li>max-subcompactions：默认值为 1，用于控制RocksDB 中并发执行的 sub-compaction 任务数量，其值为 1 表示关闭 sub-compaction。如果系统资源充足，建议提升该参数以优化 compaction 效率。</li>
<li>max-bytes-for-level-base：指定了 L1 SST 文件总的大小。这个大小是 RocksDB 进行数据分层管理和 compaction 决策的重要依据：如果 L1 层的大小设置得太小，可能会导致 L0 层的 compaction 过于频繁，进而影响写性能。反之，如果设置得太大，可能会占用较多的磁盘空间，并且影响读取性能，因为读取操作可能需要跨越更多的层级。Pika 没有在 pika.conf 中开放此参数给用户配置，而是使用其他参数（level0-file-num-compaction-trigger 和 write-buffer-size）计算后的结果。</li>
</ul>
<p>storage_options_.options.max_bytes_for_level_base = g_pika_conf-&gt;level0_file_num_compaction_trigger() * g_pika_conf-&gt;write_buffer_size()</p>
<p>关键 PR：
添加 Floyd 的 compaction-filter 的 Gtest
<a href="https://github.com/OpenAtomFoundation/pika/pull/2669" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2669</a>
添加支持分区索引过滤的功能
<a href="https://github.com/OpenAtomFoundation/pika/pull/2601" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2601</a>
新增 RocksDB Compaction 策略动态调整参数，用户可以根据业务调整 Compaction 策略，降低 Compaction 操作对服务性能的损耗
<a href="https://github.com/OpenAtomFoundation/pika/pull/2538" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2538</a>
1.6 可观测性
v3.5 版本增加了包括命中率、每秒命中次数、Redis Cache 内存使用量、Redis Cache 个数、Redis Cache DB 个数 等指标，但是在集群方面的可观测性是缺失的。v4.0.0 对 Codis-Proxy 的 P99、P999、延迟等监控指标进行采集和展示，可以直观地反映线上 Codis-proxy 的运行情况。</p>
<p>v4.0.0 开始还提供新的工具：根据 pika benchmark 工具压测结果自动生成可视化的统计图表。</p>
<p>关键 PR：
Codis 支持 info 命令, 可以通过该命令查询 Codis-proxy 的 info 信息
<a href="https://github.com/OpenAtomFoundation/pika/pull/2688" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2688</a>
Codis-proxy 新增 P99 P95 等监控耗时指标
<a href="https://github.com/OpenAtomFoundation/pika/pull/2668" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2668</a>
添加 Pika 压测指标，提升 Pika 压测效率，并输出可视化的统计图表
<a href="https://github.com/OpenAtomFoundation/pika/pull/2663" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2663</a></p>
<p>1.7 测试集
PikiwiDB(Pika)  测试集由 gtest 单测、Redis TCL 测试集和 Go 测试集组成。v4.0.0 中丰富了诸多特性的 go test 功能，并进一步完善了基本数据类型的 TCL 测试。
关键 PR：
添加 Floyd 的 compaction-filter 的 Gtest
<a href="https://github.com/OpenAtomFoundation/pika/pull/2669" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2669</a>
Pika Geo 数据类型增加 TCL 测试，并修复测试过程中遇到的缺陷
<a href="https://github.com/OpenAtomFoundation/pika/pull/2753" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2753</a>
1.8 跨平台
PikiwiDB(Pika)  以往仅支持 centos 和 ubuntu 等 linux 平台，v3.5 开始支持 Mac 等平台。v4.0.0 将对 Mac 平台的支持扩展至 FreeBSD 平台。
关键 PR：
Pika 支持在 FreeBSD14 平台上进行编译
<a href="https://github.com/OpenAtomFoundation/pika/pull/2711" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2711</a>
2 改进列表
下面详细列出了本次发版的主要功能升级和改进。
2.1 新特性</p>
<ul>
<li>Pika Geo 数据类型增加 TCL 测试，并修复测试过程中遇到的缺陷
<a href="https://github.com/OpenAtomFoundation/pika/pull/2753" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2753</a></li>
<li>Pika 支持在 FreeBSD14 平台上进行编译打包
<a href="https://github.com/OpenAtomFoundation/pika/pull/2711" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2711</a></li>
<li>Pika 线程整理，避免启动过多无用线程，对不同的线程进行命名，方便问题定位
<a href="https://github.com/OpenAtomFoundation/pika/pull/2697" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2697</a></li>
<li>Mget 支持多 key 查询缓存, 记录未命中的 key 去 DB 中查询，提升 Pika 服务的读性能
<a href="https://github.com/OpenAtomFoundation/pika/pull/2675" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2675</a></li>
<li>Codis 支持 info 命令, 可以通过该命令查询 Codis-proxy 的 info 信息
<a href="https://github.com/OpenAtomFoundation/pika/pull/2688" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2688</a></li>
<li>添加 Floyd 的 compaction-filter 的 Gtest
<a href="https://github.com/OpenAtomFoundation/pika/pull/2669" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2669</a></li>
<li>Codis-proxy 新增 P99 P95 等监控耗时指标
<a href="https://github.com/OpenAtomFoundation/pika/pull/2668" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2668</a></li>
<li>添加 Pika 压测指标，提升 Pika 压测效率，并输出可视化的统计图表
<a href="https://github.com/OpenAtomFoundation/pika/pull/2663" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2663</a></li>
<li>Pika 主从复制新增监控指标 repl_connect_status, 可以更加明确清晰的确定当前的主从复制的状态
<a href="https://github.com/OpenAtomFoundation/pika/pull/2638" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2638</a></li>
<li>Pika 不支持不同类型的重复 key, 写入重复 key 返回非法类型
<a href="https://github.com/OpenAtomFoundation/pika/pull/2609" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2609</a></li>
<li>添加支持分区索引过滤的功能
<a href="https://github.com/OpenAtomFoundation/pika/pull/2601" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2601</a></li>
<li>Pika 支持第三代存储引擎 Floyd, 通过支持多 rocksdb 实例、对 Blob 的使用进行优化、对过期数据的清理进行优化，提升了 Pika 实例的读写性能
<a href="https://github.com/OpenAtomFoundation/pika/pull/2413" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2413</a></li>
</ul>
<p>2.2 bug 修复</p>
<ul>
<li>修复 iter 未被析构，导致 pkpatternmatchdel 在返回之前不会删除 iter，这可能会导致 rocksdb 永远引用一个版本，导致数据不符合预期的问题
<a href="https://github.com/OpenAtomFoundation/pika/pull/2785" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2785</a></li>
<li>修复 config 参数 min-blob-size 带单位时解析错误的问题
<a href="https://github.com/OpenAtomFoundation/pika/pull/2767" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2767</a></li>
<li>修复 zverank 返回值异常的问题
<a href="https://github.com/OpenAtomFoundation/pika/pull/2673" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2673</a></li>
<li>修复 Pika-port 传输数据过程中报错的问题
<a href="https://github.com/OpenAtomFoundation/pika/pull/2758" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2758</a></li>
<li>修复因为堆上分配的缓冲区越界导致 Dbsize 命令运行时崩溃的问题
<a href="https://github.com/OpenAtomFoundation/pika/pull/2749" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2749</a></li>
<li>修复批量扩容时，多个 slave 同时连接 master, 短时间多次 bgsave 导致部分从节点数据不完整的问题
<a href="https://github.com/OpenAtomFoundation/pika/pull/2746" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2746</a></li>
<li>修复参数未初始化导致 slotsscan 等命令不能和 bgsave 命令相互制衡的问题
<a href="https://github.com/OpenAtomFoundation/pika/pull/2745" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2745</a></li>
<li>修复 Slotmigrate 迁移数据的过程中，返回值设置错误，异常场景下会终止数据迁移的问题
<a href="https://github.com/OpenAtomFoundation/pika/pull/2741" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2741</a></li>
<li>修复 Mget 没有使用解析 ttl 的函数导致出现部分key的ttl未被更新，数据不一致的问题
<a href="https://github.com/OpenAtomFoundation/pika/pull/2730" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2730</a></li>
<li>修复 pkpatternmatchdel 命令使用错误导致的 stream 类型数据删除异常的问题
<a href="https://github.com/OpenAtomFoundation/pika/pull/2726" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2726</a></li>
<li>修复 pkpatternmatchdel 不能正确删除掉对应的 keys 的问题
<a href="https://github.com/OpenAtomFoundation/pika/pull/2717" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2717</a></li>
<li>修复 ACL 密码验证错误问题
<a href="https://github.com/OpenAtomFoundation/pika/pull/2714" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2714</a></li>
<li>修复 Keyspace 命令未计算 Stream 类型数据的问题
<a href="https://github.com/OpenAtomFoundation/pika/pull/2705" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2705</a></li>
<li>对部分命令定制化处理逻辑，避免写 binlog 导致从节点的 binlog 解析失败的问题
<a href="https://github.com/OpenAtomFoundation/pika/pull/2793" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2793</a></li>
<li>修复 Pika cmdID 赋值在 Cmd 初始函数中，可能会导致并发构造的时候出现内存泄漏的问题
<a href="https://github.com/OpenAtomFoundation/pika/pull/2692" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2692</a></li>
<li>修复 ExpectedStale 未考虑 String 类型, 如果存在已经过期的 String 类型的 key, ExpectedStale 会返回错误的问题
<a href="https://github.com/OpenAtomFoundation/pika/pull/2682" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2682</a></li>
<li>修复 Spop 在写 binlog 时可能会出现竞态问题
<a href="https://github.com/OpenAtomFoundation/pika/pull/2674" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2674</a></li>
<li>db instance 设置不合理时，给用户错误提示
<a href="https://github.com/OpenAtomFoundation/pika/pull/2672" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2672</a></li>
<li>修复 server_stat 中的数据竞态问题
<a href="https://github.com/OpenAtomFoundation/pika/pull/2671" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2671</a></li>
<li>修复多 DB 下全量同步超时后不重试的问题
<a href="https://github.com/OpenAtomFoundation/pika/pull/2667" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2667</a></li>
<li>修复多 DB 下全量同步超时后不重试的问题
<a href="https://github.com/OpenAtomFoundation/pika/pull/2666" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2666</a></li>
<li>修复主从同步限速逻辑中重复解锁的问题
<a href="https://github.com/OpenAtomFoundation/pika/pull/2657" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2657</a></li>
<li>发版支持自动打包 centos7 和 centos8 平台的二进制编译包
<a href="https://github.com/OpenAtomFoundation/pika/pull/2535" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2535</a></li>
<li>修复 Codis 侧的 getrange 命令没有返回预期结果的问题
<a href="https://github.com/OpenAtomFoundation/pika/pull/2510" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2510</a></li>
</ul>
<p>2.3 提升改进项</p>
<ul>
<li>更新 Pika Docker Readme, 可以按照 Readme 在 Docker 中部署 Pika 服务
<a href="https://github.com/OpenAtomFoundation/pika/pull/2743" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2743</a></li>
<li>优化重复查询 meta value 导致影响 Pika 服务读写性能的问题
<a href="https://github.com/OpenAtomFoundation/pika/pull/2735" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2735</a></li>
<li>支持对更多的 RocksDB 参数进行动态调整，用户根据不同的业务使用场景调整参数提升 Pika 的读写性能
<a href="https://github.com/OpenAtomFoundation/pika/pull/2728" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2728</a></li>
<li>对 HyperLogLog 和 String 进行类型隔离，确保 HyperLogLog 操作与 String 操作明确区分开
<a href="https://github.com/OpenAtomFoundation/pika/pull/2720" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2720</a></li>
<li>更新了 PR 标题验证，不允许在标题末尾出现中文字符
<a href="https://github.com/OpenAtomFoundation/pika/pull/2718" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2718</a></li>
<li>重构主从复制模式 slave 节点的主从同步线程模型，尽可能减少 binlog 消费阻塞问题
<a href="https://github.com/OpenAtomFoundation/pika/pull/2638" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2638</a></li>
<li>新增 RocksDB Compaction 策略动态调整参数，用户可以根据业务调整 Compaction 策略，降低 Compaction 操作对服务性能的损耗
<a href="https://github.com/OpenAtomFoundation/pika/pull/2538" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2538</a></li>
</ul>
<p>2.4 发版 tag</p>
<p><a href="https://github.com/OpenAtomFoundation/pika/releases/tag/v4.0.0" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/releases/tag/v4.0.0</a>
3 社区
感谢所有为 v4.0.0 做出贡献的社区成员，包括 issue/PR 提交者、代码 reviewer 【排名不分先后，依据字母序列】：</p>
<p>AlexStocks</p>
<p>baerwang</p>
<p>chejinge</p>
<p>cheniujh</p>
<p>chienguo</p>
<p>guangkun123</p>
<p>gukj-spel</p>
<p>longfar-ncy</p>
<p>lqxhub</p>
<p>luky116</p>
<p>Mixficsol</p>
<p>saz97</p>
<p>wangshao1</p>
<p>PikiwiDB (Pika) 开源社区热烈欢迎您的参与和支持。如果您有任何问题、意见或建议，请扫码添加 PikiwiDB 小助手【微信号: PikiwiDB】为好友，它会拉您加入官方微信群。</p>
<p><img decoding="async" loading="lazy" alt="2024-07-08-PikiwiDB(Pika)-4.0.0-connect" src="https://www.pikiwidb.com/assets/images/2024-07-08-PikiwiDB(Pika)-4.0.0-connect-c43aca0eeeb5cd09cc60b55f9a3df4e5.png" width="747" height="431" class="img_ev3q"></p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[What's new in Pika v3.5.4]]></title>
            <link>https://www.pikiwidb.com/blog/Pika-3.5.4</link>
            <guid>https://www.pikiwidb.com/blog/Pika-3.5.4</guid>
            <pubDate>Thu, 16 May 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[PikiwiDB(Pika) 社区非常荣幸地宣布，我们的最新 v3.5.4 正式生产可用版本现已发布。]]></description>
            <content:encoded><![CDATA[<p>PikiwiDB(Pika) 社区非常荣幸地宣布，我们的最新 v3.5.4 正式生产可用版本现已发布。
v3.5.4 解决了历史遗留的 bug，对 PikiwiDB(Pika) 的一些遗留 bug 进行修复和优化，旨在打造出一个高稳定性的版本。本次的重点优化主要包括，PikiwiDB(Pika)支持动态调整限速参数、增强 PikiwiDB(Pika) 的客观测性指标、 磁盘 IO 限速支持读限速及写限速等。
1 新特性</p>
<ol>
<li>Pika 支持动态调整全量同步限速参数 rsync-timeout-ms 和 throttle-bytes-per-second。</li>
</ol>
<p>自 v3.5.0 版本开始，PikiwiDB(Pika)  服务摒弃了通过子进程内使用原来 rsync 工具进行主从全量同步的逻辑，在 PikiwiDB(Pika) 内部以线程方式【称作 rsync 线程】自行实现了新的全量同步逻辑，避免因为外部进程不可控引起的主从同步问题，根据 360 内部 Pika 线上大规模集群运维的经验，在 PikiwiDB(Pika) 主从进行全量同步的过程中，如果遇到某些不利的外部因素，如网络波动，硬件故障（如网卡降速导致的主从网卡速率不匹配）等，可能引起 rsync 线程请求持续超时（PikiwiDB(Pika) 内置 rsync 模块用于全量同步阶段的文件传输），且超时重试所发出的包可能引发更大的网络信道负担。此时对于运维人员来说，如果能动态调整 rsync 请求的超时时间和 rsync 传输的速率上限，不仅意味着对全量同步阶段控制粒度的进一步细化，更大大降低了在该场景下的运维处置难度。</p>
<p>关键PR：</p>
<p><a href="https://github.com/OpenAtomFoundation/pika/pull/2633" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2633</a></p>
<ol start="2">
<li>将 info key space 1 的结果输出至 info all 并展示到监控界面中。</li>
</ol>
<p>PikiwiDB(Pika)  是通过 Info 命令采集数据至 Pika-Exporter，展示到 Grafana 界面上的，目前界面上部分数据是没有展示的，如 keys 的数量，本次将执行 info keyspace 的结果展示到监控界面，用户可以通过这个指标来查看存储的量级等。</p>
<p>关键PR：</p>
<p><a href="https://github.com/OpenAtomFoundation/pika/pull/2603" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2603</a></p>
<p>3.Pika 磁盘IO 限速参数支持 OnlyRead、OnlyWrite、ReadAndWrite，默认支持OnlyWrite。</p>
<p>自3.5.0版本开始，PikiwiDB(Pika)  服务可以通过调整 rate-limit 参数实现写限速，防止在网卡质量不高的情况下磁盘 IO 过重导致服务不可用，或者 binlog 阻塞的情况发生。360内部 Pika 线上大规模集群运维的经验，在 PikiwiDB(Pika) 实例的网卡较差情况下，也需要对读实例进行限速，本次修改支持读、写限速，默认是写限速，调整 config 配置中的 rate-limiter-mode 可以设置为读限速，或者同时读写限速。</p>
<p>关键PR：</p>
<p><a href="https://github.com/OpenAtomFoundation/pika/pull/2599" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2599</a></p>
<p>2 改进列表</p>
<p>slotmigrate 添加 go test。</p>
<p><a href="https://github.com/OpenAtomFoundation/pika/pull/2576" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2576</a></p>
<p>INFO 命令耗时优化，降低查磁盘频率，避免因为数据采集调用 info 命令时查磁盘太过频繁导致服务性能下降。</p>
<p><a href="https://github.com/OpenAtomFoundation/pika/pull/2554" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2554</a></p>
<p>对五种基本数据类型命令增加 Redis tcl 测试。</p>
<p><a href="https://github.com/OpenAtomFoundation/pika/pull/2527" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2527</a></p>
<p>3 Bug 修复</p>
<p>修复使用 Pika Exporter 时可能会出现 slots 分配不均衡的问题。</p>
<p><a href="https://github.com/OpenAtomFoundation/pika/pull/2651" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2651</a></p>
<p>修复 Codis dashboard 不能正确更新 master 实例状态的问题。</p>
<p><a href="https://github.com/OpenAtomFoundation/pika/pull/2650" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2650</a></p>
<p>修复 Redis 事务 binlog 解析失败导致的主从同步异常问题。</p>
<p><a href="https://github.com/OpenAtomFoundation/pika/pull/2642" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2642</a></p>
<p>修复 Pika Expoter 启动时不带参数导致启动失败问题。</p>
<p><a href="https://github.com/OpenAtomFoundation/pika/pull/2640" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2640</a></p>
<p>修复使用 Pika Operater 拉起集群 Codis-proxy panic 的问题。</p>
<p><a href="https://github.com/OpenAtomFoundation/pika/pull/2633" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2633</a></p>
<p>修复 CI 编译出的二进制进行自动化测试时 cp 命令失败问题。</p>
<p><a href="https://github.com/OpenAtomFoundation/pika/pull/2614" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2614</a></p>
<p>修复变量未初始化导致 cache 启动失败的问题。</p>
<p><a href="https://github.com/OpenAtomFoundation/pika/pull/2613" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2613</a></p>
<p>修复 userpass 和 userblacklist 动态修改参数功能异常问题。</p>
<p><a href="https://github.com/OpenAtomFoundation/pika/pull/2600" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2600</a></p>
<p>修复 scard sscan 结果不一致的问题。</p>
<p><a href="https://github.com/OpenAtomFoundation/pika/pull/2596" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2596</a></p>
<p>修复当 max-rsync-parallel-num 大于4，slave 会在主从复制时 coredump 的问题。</p>
<p><a href="https://github.com/OpenAtomFoundation/pika/pull/2595" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2595</a></p>
<p>调整不常用的线程池线程数，避免因为空跑导致性能损耗。</p>
<p><a href="https://github.com/OpenAtomFoundation/pika/pull/2590" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2590</a></p>
<p>修复 Pika 事务边缘测试 case 不通过的问题。</p>
<p><a href="https://github.com/OpenAtomFoundation/pika/pull/2586" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2586</a></p>
<p>将 cache-model 修改成 cache-mode。</p>
<p><a href="https://github.com/OpenAtomFoundation/pika/pull/2585" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2585</a></p>
<p>修复使用 info keyspace 后，info all 死锁的问题。</p>
<p><a href="https://github.com/OpenAtomFoundation/pika/pull/2584" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2584</a></p>
<p>修复因修改 zsetscorekey comparator impl 字典序比较熟顺序，导致 353 352极端场景不兼容的问题。</p>
<p><a href="https://github.com/OpenAtomFoundation/pika/pull/2583" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2583</a></p>
<p>修复 compact 死锁的问题。</p>
<p><a href="https://github.com/OpenAtomFoundation/pika/pull/2581" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2581</a></p>
<p>Slotmigrate 添加 go test。</p>
<p><a href="https://github.com/OpenAtomFoundation/pika/pull/2576" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2576</a></p>
<p>更新 Pika Operater 使用的 pika 版本。</p>
<p><a href="https://github.com/OpenAtomFoundation/pika/pull/2572" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2572</a></p>
<p>修复 config rewrite 后 blockcache 数值异常的问题。</p>
<p><a href="https://github.com/OpenAtomFoundation/pika/pull/2561" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2561</a></p>
<p>修复 slotmigrate 动态修复后值错误的问题。</p>
<p><a href="https://github.com/OpenAtomFoundation/pika/pull/2548" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2548</a></p>
<p>修复 spop 可能会出现主从数据不一致的问题。</p>
<p><a href="https://github.com/OpenAtomFoundation/pika/pull/2541" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2541</a></p>
<p>修复 CloseFd(it-&gt;second[i]) 出现越界的问题。</p>
<p><a href="https://github.com/OpenAtomFoundation/pika/pull/2539" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2539</a></p>
<p>修复 Flushall 和 FlushDB 死锁的隐患，并删除 FlushSubDB 接口。</p>
<p><a href="https://github.com/OpenAtomFoundation/pika/pull/2533" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2533</a></p>
<p>增加参数控制是否清理 tcl 测试后产生的数据文件，防止废弃数据占据磁盘。</p>
<p><a href="https://github.com/OpenAtomFoundation/pika/pull/2507" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2507</a></p>
<p><img decoding="async" loading="lazy" alt="2024-05-16-Pika-3.5.4-connect.png" src="https://www.pikiwidb.com/assets/images/2024-05-16-Pika-3.5.4-connect-c43aca0eeeb5cd09cc60b55f9a3df4e5.png" width="747" height="431" class="img_ev3q"></p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[What's new in Pika v3.5.3 ]]></title>
            <link>https://www.pikiwidb.com/blog/Pika-3.5.3</link>
            <guid>https://www.pikiwidb.com/blog/Pika-3.5.3</guid>
            <pubDate>Wed, 27 Mar 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[随着 Redis 宣布采用双协议以维护其商业利益之际，PikiwiDB(Pika) 社区非常荣幸地宣布，我们的最新 v3.5.3 正式生产可用版本现已发布。]]></description>
            <content:encoded><![CDATA[<p>随着 Redis 宣布采用双协议以维护其商业利益之际，PikiwiDB(Pika) 社区非常荣幸地宣布，我们的最新 v3.5.3 正式生产可用版本现已发布。</p>
<p>v3.5.3 解决了历史遗留的 Bug，引入了多项新特性。这些特性主要包括 Pika 支持 ACL、删除 Sharing 模式残留的 Slot 代码、快慢命令分离、 Redis Stream、大 key 分析工具、Pika 分布式集群支持全自动化 failover 等功能，同时，我们在 3.5.3 版本丰富了更多的自动化测试 case，提升 Pika 服务的稳定性和健壮性，会让用户感受到更为高效和稳定的使用体验，本文主要阐述本次改动的相关重大 feature、bugfix 性能提升项。</p>
<p>在深入探讨 3.5.3 版本的更新内容之前，请注意以下几点声明：</p>
<ol>
<li>由于商标问题，Pika 项目已更名为 PikiwiDB。文中以 PikiwiDB(Pika) 指代项目<br>
<a href="https://github.com/OpenAtomFoundation/pika" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika</a></li>
<li>我们新创建了一个项目<br>
<a href="https://github.com/OpenAtomFoundation/pikiwidb" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pikiwidb</a>
这是一个基于 Raft 协议实现的兼容 Redis 协议的大容量 KV 数据库，主要面向强一致性数据场景，例如存储约 10TiB 规模的元数据。PikiwiDB  将专门用于指代此项目。</li>
<li>我们为 PikiwiDB 设计了一个新的 logo，作为其商标，并已在相关政府机构注册。</li>
</ol>
<p><img decoding="async" loading="lazy" alt="2024-03-27-Pika-3.5.3-logo" src="https://www.pikiwidb.com/assets/images/2024-03-27-Pika-3.5.3-logo-b2c4565b5d1adebda975b365a3bcf337.png" width="1080" height="451" class="img_ev3q"></p>
<p>1 重大改进</p>
<p>1.1 PikiwiDB(Pika) 支持 ACL</p>
<p>PikiwiDB(Pika) 3.5.3 版本正式全面支持 Redis ACL，为未来在云原生 Pika 集群中支持多租户场景奠定了基础。在此之前，Pika 已经支持了 Redis 的用户认证方式，如 auth/userpass/requirepass，以及通过 pika.conf 中的 userblacklist 配置命令黑名单模式。本次更新保持了向后兼容，并支持这些已有的使用方式。</p>
<p>我们还确保 PikiwiDB(Pika) 的 ACL 实现与 Redis ACL 完全兼容，通过将 Redis 的所有 ACL TCL 测试集纳入 PikiwiDB(Pika) 的测试集中。</p>
<p>关键 PR：</p>
<ul>
<li>PikiwiDB(Pika)  支持 ACL
<a href="https://github.com/OpenAtomFoundation/pika/pull/2013" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2013</a></li>
<li>修正 ACL 用户认证错误问题
<a href="https://github.com/OpenAtomFoundation/pika/pull/2449" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2449</a></li>
<li>ACL 向前兼容 userblacklist
<a href="https://github.com/OpenAtomFoundation/pika/pull/2459" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2459</a></li>
<li>添加 Redis ACL 测试集
<a href="https://github.com/OpenAtomFoundation/pika/pull/2495" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2495</a></li>
</ul>
<p>1.2 混合存储模型支持 bitmap</p>
<p>在单体环境下，同时优化 PikiwiDB(Pika) 的读/写/compaction 是一项挑战。在 v3.5.2 版本中，我们引入了由缓存 Redis 和 RocksDB 构成的混合存储模型，并支持了 string/list/set/zset/hashtable 五种数据结构。在 3.5.3 版本中，我们增加了对 bitmap 的支持。</p>
<p>此外，我们在 3.5.3 版本中支持对 Redis 缓存进行动态参数调整。</p>
<p>关键 PR 链接：</p>
<ul>
<li>
<p>支持 bitmap 的支持：
<a href="https://github.com/OpenAtomFoundation/pika/pull/2253" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2253</a></p>
</li>
<li>
<p>另外，我们在 3.5.3 版本中支持对 Redis 缓存进行动态调参：
<a href="https://github.com/OpenAtomFoundation/pika/pull/2197" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2197</a></p>
</li>
</ul>
<p>1.3 快慢命令分离</p>
<ul>
<li>为了防止慢命令把快命令执行卡死，我们在 Codis-Proxy 和 PikiwiDB(Pika)  两个层面都实现了快慢命令分离。
<a href="https://github.com/OpenAtomFoundation/pika/pull/2162" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2162</a></li>
</ul>
<p>1.4 Redis Stream</p>
<p>虽然 PikiwiDB(Pika) 之前支持了 Redis pubsub，但它只能进行在线消息传递。在 3.5.3 版本中，我们增加了对 Redis Stream 的有限支持，类似于消息队列（MQ），以便更安全地传递消息。为了确保数据的安全性，我们在底层引擎 BlackWidow 中特别添加了对 Stream 数据类型的支持。
关键 PR：</p>
<ul>
<li>Pika 支持 Redis Stream
<a href="https://github.com/OpenAtomFoundation/pika/pull/1955" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/1955</a>
请注意，Pika Stream 目前还不支持消费组消费，这将在后续版本中实现。</li>
</ul>
<p>1.5 云原生集群</p>
<p>在 PikiwiDB(Pika) 3.5.0 版本中，我们开源了 Pika-Operator，它支持在 K8s 上部署 Pika 主从对。在 3.5.2 版本中，我们基于 Kubeblocks 的 Pika-Operator 支持了在 K8s 上部署类似 Codis 的 Pika Cluster，但当时还不支持动态扩缩容。</p>
<p>在 3.5.3 版本中，最新的 Pika-Operator 已经支持了 Codis Group 级别的节点扩缩容，并且支持数据的 Rebalance。
关键 PR：</p>
<ul>
<li>
<p>PikiwiDB(Pika)  Operator 支持 pika 集群自动扩容
<a href="https://github.com/OpenAtomFoundation/pika/pull/2121" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2121</a></p>
</li>
<li>
<p>优化 codis slot 迁移速度，支持动态修改迁移线程和速度
<a href="https://github.com/OpenAtomFoundation/pika/pull/2486" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2486</a></p>
</li>
<li>
<p>Pika-operator 支持 namespace，在不同的 namespace 下部署不同的集群
<a href="https://github.com/OpenAtomFoundation/pika/pull/2480" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2480</a></p>
</li>
<li>
<p>Pika-operator 支持监控指标采集，自动拉起 pika-expoter</p>
<p><a href="https://github.com/OpenAtomFoundation/pika/pull/2451" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2451</a>
1.6 Compaction 改进</p>
</li>
</ul>
<p>PikiwiDB(Pika) 的底层磁盘存储引擎 RocksDB 在进行 compaction 时会显著影响 PikiwiDB(Pika) 的读写性能。因此，控制好 compaction 是优化 Pika 读写性能的关键。
有关 compaction 的关键优化 PR 如下：</p>
<ul>
<li>添加 CompactRange 命令支持对一定范围内的 key 进行 compact
<a href="https://github.com/OpenAtomFoundation/pika/pull/2163" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2163</a></li>
<li>提升 Compaction 速度减少 Compaction 耗时
<a href="https://github.com/OpenAtomFoundation/pika/pull/2172" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2172</a></li>
<li>执行 shutdown 命令时调用 disable compaction, 提升进程退出速度
<a href="https://github.com/OpenAtomFoundation/pika/pull/2345" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2345</a></li>
</ul>
<p>1.7 自动 Failover</p>
<p>PikiwiDB(Pika) 集群目前是基于 Codis 实现的。为了提高基于 Codis 的 PikiwiDB(Pika) Cluster 的易用性，我们对 Codis 进行了许多扩展。</p>
<p>原始的 Codis 不支持 Group 内的 Failover，需要使用 Redis Sentinel，这会导致运维成本增加。我们在 Codis Dashboard 中加入了 sentinel 的功能，实现了对 Group 内主从的自动 failover。</p>
<p>关键 PR：</p>
<ul>
<li>PikiwiDB(Pika)  分布式集群支持自动 failover
<a href="https://github.com/OpenAtomFoundation/pika/pull/2386" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2386</a></li>
</ul>
<p>1.8 可观测性提升</p>
<p>PikiwiDB(Pika) 的可观测性关键组件是 Pika-Exporter。在 3.5.2 版本中，我们虽然添加了 Redis Cache 缓存热数据，但缺少监控指标。在 3.5.3 版本中，我们增加了包括命中率、每秒命中次数、Redis Cache 内存使用量、Redis Cache 个数、Redis Cache DB 个数 等指标。</p>
<p>关键 PR：</p>
<ul>
<li>PikiwiDB(Pika)  exporter 暴露 cache 相关的数据采集指标<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2318" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2318</a></li>
<li>PikiwiDB(Pika)  分布式集群 Codis proxy 新增可观测指标<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2199" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2199</a></li>
<li>修复dbsize 计算错误问题<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2494" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2494</a></li>
<li>修复网络监控指标统计不准确的问题<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2234" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2234</a>
1.9 数据一致性
3.5.3 版本修复了许多 PikiwiDB(Pika) 主从同步问题，确保数据的一致性。</li>
</ul>
<p>关键 PR：</p>
<ul>
<li>修复主从复制过程中, slave 节点收到 master 异常回包后的处理逻辑<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2319" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2319</a></li>
<li>修复 Pika cache 部分场景下 cache 和 DB 数据不一致的问题<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2225" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2225</a></li>
<li>修复全量复制失败后，未做处理导致数据丢失问题<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2439" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2439</a></li>
<li>修复主从复制过程中，主实例执行 bgsave 过程中，没有正确回应从的同步请求<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2437" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2437</a></li>
<li>全量复制过程中，添加数据同步状态，明确数据同步进度<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2430" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2430</a></li>
<li>修复从库在 Apply binlog 时，没有对操作的 key 加锁，导致数据不一致的问题<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2409" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2409</a></li>
<li>修复迁移数据后数据不一致的问题<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2485" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2485</a></li>
</ul>
<p>1.10 添加测试集</p>
<p>PikiwiDB(Pika)  测试集由 gtest 单测、Redis TCL 测试集和 Go 测试集组成：</p>
<ul>
<li>gtest 单测主要测试 Pika  C++ 代码</li>
<li>Redis TCL 测试集来自 Redis，用于测试 PikiwiDB(Pika)  对 Redis 标准命令兼容度</li>
<li>Go 测试集可对 Pika 进行 Redis 命令测试、主从和 Codis 集群 e2e 测试</li>
</ul>
<p>3.5.3 中添加了 Codis 集群 e2e 测试，关键 PR 如下：</p>
<ul>
<li>丰富了 Pika TCL 测试集<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2497" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2497</a></li>
<li>丰富了 Pika Gotest 测试集<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2502" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2502</a></li>
</ul>
<p>1.11 工具集
PikiwiDB(Pika) 一直重视工具集的建设，所有相关工具都可以在     <a href="https://github.com/OpenAtomFoundation/pika/tree/unstable/tools" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/tree/unstable/tools</a> 中找到。在 3.5.3 版本中，我们新增了一个工具：</p>
<p>PikiwiDB(Pika)  支持大 key 分析工具
<a href="https://github.com/OpenAtomFoundation/pika/pull/2195" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2195</a></p>
<p>1.12 文档更新</p>
<p>PikiwiDB(Pika) 的文档主要是 wiki 文档。在 3.5.3 版本中，我们更新了 Pika 支持的 Redis 命令文档。</p>
<p>文档链接：    <a href="https://github.com/OpenAtomFoundation/pika/wiki/pika-%E6%94%AF%E6%8C%81%E7%9A%84redis%E6%8E%A5%E5%8F%A3%E5%8F%8A%E5%85%BC%E5%AE%B9%E6%83%85%E5%86%B5" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/wiki/pika-%E6%94%AF%E6%8C%81%E7%9A%84redis%E6%8E%A5%E5%8F%A3%E5%8F%8A%E5%85%BC%E5%AE%B9%E6%83%85%E5%86%B5</a>
2 改进列表</p>
<p>在第一章节中，我们概述了 3.5.3 版本的主要功能升级和改进。下面详细列出了本次发版的相关 PR。</p>
<p>2.1 新特性</p>
<ul>
<li>
<p>Pika 支持 ACL</p>
<p><a href="https://github.com/OpenAtomFoundation/pika/pull/2013" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2013</a></p>
</li>
<li>
<p>在全量复制的过程中，pika 服务的从节点不接收读请求</p>
<p><a href="https://github.com/OpenAtomFoundation/pika/pull/2197" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2197</a></p>
</li>
<li>
<p>删除 Sharing 模式残留的 Slot 代码，回归 3.0，以后一个 Pika 下有多个 DB，每个 DB 只有一个 Blackwidow<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2251" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2251</a></p>
</li>
<li>
<p>在 Codis dashboard 协程 panic 时自动恢复服务<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2349" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2349</a></p>
</li>
<li>
<p>Pika cache 新增 bimap数据类型<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2253" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2253</a></p>
</li>
<li>
<p>Pika 支持快慢命令分离<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2162" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2162</a></p>
</li>
<li>
<p>Pika exporter 暴露 cache 相关的数据采集指标<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2318" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2318</a></p>
</li>
<li>
<p>Pika 执行完成 Bgsave 后, 保留 unix timepoint<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2167" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2167</a></p>
</li>
<li>
<p>Pika 支持动态配置 disable_auto_compations 参数<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2257" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2257</a></p>
</li>
<li>
<p>Pika 支持 Redis Stream<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/1955" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/1955</a></p>
</li>
<li>
<p>Pika 支持大 key 分析工具<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2195" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2195</a></p>
</li>
<li>
<p>Pika 支持动态调整 Pika cache 参数<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2197" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2197</a></p>
</li>
<li>
<p>更新 Pika benchmark 工具支持更多的接口压测<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2222" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2222</a></p>
</li>
<li>
<p>Pika Operator 支持 pika 集群自动扩容<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2121" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2121</a></p>
</li>
<li>
<p>添加 CompactRange 命令支持对一定范围内的 key 进行 compact<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2163" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2163</a></p>
</li>
<li>
<p>提升 Compaction 速度减少 Compaction 耗时<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2172" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2172</a></p>
</li>
<li>
<p>升级 RocksDB 版本到 v8.7.3<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2157" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2157</a></p>
</li>
<li>
<p>Pika 分布式集群 Codis proxy 新增可观测指标<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2199" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2199</a></p>
</li>
<li>
<p>Pika 分布式集群支持自动 failover<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2386" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2386</a></p>
</li>
<li>
<p>Pika 支持 redis rename-command 功能<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2455" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2455</a></p>
</li>
<li>
<p>优化 codis slot 迁移速度，支持动态修改迁移线程和速度<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2486" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2486</a></p>
</li>
<li>
<p>Pika 支持动态调整 max-conn-rbuf-size 参数<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2434" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2434</a></p>
</li>
<li>
<p>Pika-operator 支持 namespace，可以在不同的 namespace 下部署不同的集群<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2480" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2480</a></p>
</li>
<li>
<p>Pika-operator 支持监控指标采集，自动拉起 pika-expoter<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2451" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2451</a></p>
</li>
<li>
<p>ACL 向前兼容 userblacklist<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2459" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2459</a></p>
</li>
<li>
<p>丰富了 Pika TCL 测试集<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2497" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2497</a></p>
</li>
<li>
<p>丰富了 Pika Gotest 测试集<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2502" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2502</a></p>
</li>
</ul>
<p>2.2 bug 修复</p>
<ul>
<li>修复 Pika 有从节点进行全量复制期间会误删除 dump 文件的问题<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2377" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2377</a></li>
<li>修复主从复制过程中, slave 节点收到 master 异常回包后的处理逻辑<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2319" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2319</a></li>
<li>在 Pika 执行 shutdown 命令时调用 disable compaction, 提升进程退出速度<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2345" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2345</a></li>
<li>修复 Codis-dashboard Redis Memory 值不准确的问题<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2337" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2337</a></li>
<li>INFO 命令耗时优化，降低查磁盘使用量的频率<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2197" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2197</a></li>
<li>修复 Rsync 删除临时文件路径不对，删除失败，导致rocksdb打开失败的问题<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2186" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2186</a></li>
<li>修复 Compact ,Bgsave ,Info keyspace 命令未指定db名称，导致部分命令 coredump 的问题<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2194" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2194</a></li>
<li>Codis dashboard 用 info replication 替代 info 命令查寻 master ip 降低对 Pika 的性能影响<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2198" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2198</a></li>
<li>修复 Pika cache 使用边缘case，解决部分场景下 cache 和 DB 数据不一致的问题<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2225" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2225</a></li>
<li>修复当 dump 文件夹为空时，会启动报错 Segmentation fault 的问题<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2265" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2265</a></li>
<li>修复因为 flag 计算错误，导致的部分命令缓存没有生效问题<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2217" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2217</a></li>
<li>修复主从复制模式下，主实例 flushdb 后，从实例因为死锁导致的不能访问的问题<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2249" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2249</a></li>
<li>修复部分命令未对 RocksDB 的返回值进行判断的问题<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2187" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2187</a></li>
<li>规范函数的返回值及初始值<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2176" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2176</a></li>
<li>修复网络监控指标统计不准确的问题<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2234" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2234</a></li>
<li>修复配置文件加载部分参数异常的问题<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2218" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2218</a></li>
<li>修复 Codis dashboard cpu 100% 的问题<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2393" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2393</a></li>
<li>修复 Codis fe pika 主从角色显示异常的问题<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2387" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2387</a></li>
<li>修复迁移数据后数据不一致的问题<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2485" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2485</a></li>
<li>修复dbsize 计算错误问题<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2494" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2494</a></li>
<li>修复扩缩容或者 pod 起停后，Codis-dashboard 界面显示不准确的问题<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2475" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2475</a></li>
<li>修复 DB 层重复上锁的问题<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2372" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2372</a></li>
<li>修复全量复制失败后，未做处理导致数据丢失问题<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2439" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2439</a></li>
<li>修复主从复制过程中，主实例执行 bgsave 过程中，没有正确回应从的同步请求<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2437" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2437</a></li>
<li>全量复制过程中，添加数据同步状态，明确数据同步进度<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2430" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2430</a></li>
<li>修复从库在 Apply binlog 时，没有对操作的 key 加锁，导致数据不一致的问题<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2409" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2409</a></li>
<li>修复 codis slot 迁移过程中 master 实例 coredump 的问题<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2415" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2415</a></li>
<li>修复在主从复制过程中，删除正在使用的 dump 文件的问题<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2377" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2377</a></li>
<li>修复主从复制过程中从实例 rsync 响应错误的问题<br>
<a href="https://github.com/OpenAtomFoundation/pika/pull/2319" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2319</a></li>
</ul>
<p>2.3 发版 tag
<a href="https://github.com/OpenAtomFoundation/pika/releases/tag/v3.5.3" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/releases/tag/v3.5.3</a>
3 社区</p>
<p>如果你有任何疑问，欢迎加入交流群，PikiwiDB(Pika) 开源社区感谢大家的支持和帮助。</p>
<p><img decoding="async" loading="lazy" alt="2024-03-27-Pika-3.5.3-connect" src="https://www.pikiwidb.com/assets/images/2024-03-27-Pika-3.5.3-connect-c43aca0eeeb5cd09cc60b55f9a3df4e5.png" width="747" height="431" class="img_ev3q"></p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[What's new in Pika v3.5.0]]></title>
            <link>https://www.pikiwidb.com/blog/Pika-3.5.0</link>
            <guid>https://www.pikiwidb.com/blog/Pika-3.5.0</guid>
            <pubDate>Sun, 03 Dec 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[Pika 社区近期发布了备受期待的 v3.5.2 版本 https://github.com/OpenAtomFoundation/pika/releases/tag/v3.5.2-alpha ，不仅解决了历史遗留的 Bug 问题，还引入了多项新特性。这些新特性主要包括 Pika 支持 Redis 事务、Pika 上层增加缓存层实现冷热数据分离、提升读性能、Codis-Proxy 支持动态修改配置参数等等，无疑将会让用户感受到更为高效和稳定的使用体验。]]></description>
            <content:encoded><![CDATA[<p>Pika 社区近期发布了备受期待的 v3.5.2 版本 <a href="https://github.com/OpenAtomFoundation/pika/releases/tag/v3.5.2-alpha" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/releases/tag/v3.5.2-alpha</a> ，不仅解决了历史遗留的 Bug 问题，还引入了多项新特性。这些新特性主要包括 Pika 支持 Redis 事务、Pika 上层增加缓存层实现冷热数据分离、提升读性能、Codis-Proxy 支持动态修改配置参数等等，无疑将会让用户感受到更为高效和稳定的使用体验。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="新特性">新特性<a class="hash-link" aria-label="新特性的直接链接" title="新特性的直接链接" href="https://www.pikiwidb.com/blog/Pika-3.5.0#%E6%96%B0%E7%89%B9%E6%80%A7">​</a></h2>
<ul>
<li>Pika 支持 Redis 事务，使得 Pika 的数据够在一系列命令的执行中保持数据的一致性和可靠性。 <a href="https://github.com/OpenAtomFoundation/pika/pull/2124" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2124</a></li>
<li>Pika 上层增加缓存层实现冷热数据分离，提升读性能。 <a href="https://github.com/OpenAtomFoundation/pika/pull/2171" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2171</a></li>
<li>Codis-Proxy 支持动态修改配置参数，方便我们做参数调整。 <a href="https://github.com/OpenAtomFoundation/pika/pull/2110" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2110</a></li>
<li>补全 Go Test 测试用例。 <a href="https://github.com/OpenAtomFoundation/pika/pull/2082" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2082</a></li>
<li>CI 增加 cache 提升编译速度。 <a href="https://github.com/OpenAtomFoundation/pika/pull/2093" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2093</a></li>
<li>增加 redis-copy 流量复制工具。 <a href="https://github.com/OpenAtomFoundation/pika/pull/2060" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2060</a></li>
</ul>
<p>bugfix</p>
<ul>
<li>修复 pika 在使用 SETRANGE 命令出现 coredump 的问题。 <a href="https://github.com/OpenAtomFoundation/pika/pull/2141" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2141</a></li>
<li>修复因删除 Clearreplicationid 写进 binlog 导致的全量复制问题。 <a href="https://github.com/OpenAtomFoundation/pika/pull/2135" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2135</a></li>
<li>修改锁粒度，提升 pika 写 binlog 的性能。 <a href="https://github.com/OpenAtomFoundation/pika/pull/2129" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2129</a></li>
<li>修复复杂数据类型成员变量可能出现数据溢出。 <a href="https://github.com/OpenAtomFoundation/pika/pull/2106" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2106</a></li>
<li>修复 decr 命令返回值错误问题。 <a href="https://github.com/OpenAtomFoundation/pika/pull/2092" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2092</a></li>
<li>修复 setrange 和 setbit 命令没有保留原 key 的过期时间的问题。 <a href="https://github.com/OpenAtomFoundation/pika/pull/2095" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2095</a></li>
</ul>
<p>下期版本规划</p>
<p>预计再过两个月左右，我们会在农历新年前发布  3.5.3  版本，相关关键特性有：</p>
<ul>
<li>Pika 通过快慢命令分离提升读写性能。 <a href="https://github.com/OpenAtomFoundation/pika/pull/2162" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2162</a></li>
<li>支持 Redis ACL，在 Pika 中引入用户概念，进行权限控制。 <a href="https://github.com/OpenAtomFoundation/pika/pull/2013" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2013</a></li>
<li>支持 Redis Stream，实现消息队列。 <a href="https://github.com/OpenAtomFoundation/pika/pull/1955" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/1955</a></li>
<li>添加 Pika 特有命令 compactrange，对指定范围内的 key 进行 compact   以解决大 key 删除时读放大的问题。 <a href="https://github.com/OpenAtomFoundation/pika/pull/2163" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2163</a></li>
<li>支持 lastsave 指令。 <a href="https://github.com/OpenAtomFoundation/pika/pull/2167" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2167</a></li>
</ul>
<p>感谢大家对 Pika 开源公众号的关注 ，Pika 3.5 版本重大特性及使用规范我们会在稍后的文章中进行介绍，我们下期再见～</p>
<p><img decoding="async" loading="lazy" alt="2023-09-28-Pika-3.5.2-connect" src="https://www.pikiwidb.com/assets/images/2023-12-03-Pika-3.5.2-connect-a766680ff0766c42b3506846465fd45b.png" width="747" height="431" class="img_ev3q"></p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[What's new in Pika v3.5.1]]></title>
            <link>https://www.pikiwidb.com/blog/Pika-3.5.1</link>
            <guid>https://www.pikiwidb.com/blog/Pika-3.5.1</guid>
            <pubDate>Thu, 28 Sep 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[Pika 社区很高兴宣布，我们今天发布已经过我们生产环境验证 v3.5.1 版本 https://github.com/OpenAtomFoundation/pika/releases/tag/v3.5.1 。]]></description>
            <content:encoded><![CDATA[<p>Pika 社区很高兴宣布，我们今天发布已经过我们生产环境验证 v3.5.1 版本 <a href="https://github.com/OpenAtomFoundation/pika/releases/tag/v3.5.1" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/releases/tag/v3.5.1</a> 。</p>
<p>该版本不仅做了很多优化工作，还引入了多项新功能。这些新功能包括 动态关闭 WAL、ReplicationID 检测是否增量复制、在 K8s 环境上 Pika 服务的自动注册从而实现集群的自组织、以及 exporter 检测集群指标等等，无疑将会让用户享受到更为稳定和高效的 NoSQL 使用体验。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="新特性">新特性<a class="hash-link" aria-label="新特性的直接链接" title="新特性的直接链接" href="https://www.pikiwidb.com/blog/Pika-3.5.1#%E6%96%B0%E7%89%B9%E6%80%A7">​</a></h2>
<ul>
<li>1 Slow log 增加队列等待时间统计，在队列阻塞的时候方便我们进行问题定位。PR 1997， 作者 wangshao1。</li>
<li>2 主从复制使用 ReplicationID 判断是否进行增量同步，解决原主从同步方式切主后整个数据集会进行全量复制的问题，可以提升 Pika 性能。PR 1951， 作者 Mixficsol。</li>
<li>3 WAL 以 'disablewal' 命令方式支持动态关闭，在写性能遇到瓶颈的时候，可以通过命令关闭 WAL  缓解写性能下降的问题，关闭 WAL 有机器宕机后丢失数据的风险，用户需要根据自己的使用习惯权衡。PR 2015，作者 Mixficsol。</li>
<li>4 flush 线程数和 compaction 线程数合二为一，在 Compaction 性能瓶颈时，可以动态调整线程数，缓解 Comapction 损耗 Pika 性能的问题。PR 2014， 作者 Tianpingan。</li>
<li>5 升级了 RocksDB 版本到 v8.3.3。PR 2000， 作者 dingxiaoshuai123。</li>
<li>6 新增周期性打印工作队列的长度功能，在队列阻塞的时候可以快速定位问题。PR 1978， 作者 Tianpingan。</li>
<li>7 新增利用一个 pika_exporter 监测整个集群的指标，实现一个 Pika Exporter 实例监控整个集群，解决了 3.5.0 版本一个 Pika Exporter  监测一个 Pika 实例消耗资源的问题。PR 1953， 作者 chenbt-hz。</li>
<li>8 实现在  K8s  环境上  Pika  服务的自动注册，在启动时自动注册，从而实现集群的自组织 ，实现了通过命令拉起整个 Pika Cluster 集群。PR 1931， 作者 machinly。</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-bug-修复">2 bug 修复<a class="hash-link" aria-label="2 bug 修复的直接链接" title="2 bug 修复的直接链接" href="https://www.pikiwidb.com/blog/Pika-3.5.1#2-bug-%E4%BF%AE%E5%A4%8D">​</a></h2>
<ul>
<li>1 调整了 Rate_limit 参数，修复了压测时出现 RPS 为 0 的情况 。PR 2009， 作者 Mixficsol。</li>
<li>2 修复了 INFODATA 命令中对于遍历数据文件时出现空路径的逻辑判断。PR 1996， 作者 Mixficsol。</li>
<li>3 修复了 Codis 在线上出现大毛刺的问题。PR 2016， 作者 chejinge。</li>
<li>4 修复了 macOS 环境下编译使用 tools 导致编译不过的问题 。PR 2011， 作者 A2ureStone。</li>
<li>5 减少了 exporter 非必要日志的打印，降低 了资源利用率。PR 1945， 作者 Mixficsol。</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-使用建议">3 使用建议<a class="hash-link" aria-label="3 使用建议的直接链接" title="3 使用建议的直接链接" href="https://www.pikiwidb.com/blog/Pika-3.5.1#3-%E4%BD%BF%E7%94%A8%E5%BB%BA%E8%AE%AE">​</a></h2>
<p>本次新增了几个配置参数，大家在使用过程中，需要根据使用情况按需调整：</p>
<ul>
<li>1 max-rsync-parallel-num：主从全量复制线程数，需要根据自己机器 CPU 核数和部署实例个数进行调整，建议最小设置为 2。</li>
<li>2 rate-limiter-bandwidth: 限制 RocksDB 数据库读写速度，限制数据库在一定时间内可以读写的数据量，默认 2000MiB/s，需要根据自己的机器性能和部署实例做调整。</li>
<li>max-background-jobs: compaction 和 flushdb 线程数，要根据自己机器 CPU 核数和部署实例个数进行调整，建议最小设置为 4。</li>
<li>3 throttle-bytes-per-second: 主从复制传输限速参数，默认为 200MiB/s，该参数可以根据机器网卡的配置及部署 pika 实例的个数进行调整。</li>
</ul>
<p><img decoding="async" loading="lazy" alt="2023-09-28-Pika-3.5.1-connect.png" src="https://www.pikiwidb.com/assets/images/2023-09-28-Pika-3.5.1-connect-65452ee30b0e2dff6c5affd2ee5406a1.png" width="644" height="271" class="img_ev3q"></p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[What's new in Pika v3.5.0]]></title>
            <link>https://www.pikiwidb.com/blog/Pika-3.5.0</link>
            <guid>https://www.pikiwidb.com/blog/Pika-3.5.0</guid>
            <pubDate>Fri, 25 Aug 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[时隔两年，Pika 社区正式发布经由社区 50 多人参与开发并在 360 生产环境验证可用的 v3.5.0 版本，新版本在提升性能的同时，也支持了 Codis 集群部署，BlobDB KV 分离，增加 Exporter 等新特性。]]></description>
            <content:encoded><![CDATA[<p>Pika 社区近期发布了备受期待的 v3.5.2 版本 <a href="https://github.com/OpenAtomFoundation/pika/releases/tag/v3.5.2-alpha" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/releases/tag/v3.5.2-alpha</a> ，不仅解决了历史遗留的 Bug 问题，还引入了多项新特性。这些新特性主要包括 Pika 支持 Redis 事务、Pika 上层增加缓存层实现冷热数据分离、提升读性能、Codis-Proxy 支持动态修改配置参数等等，无疑将会让用户感受到更为高效和稳定的使用体验。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="新特性">新特性<a class="hash-link" aria-label="新特性的直接链接" title="新特性的直接链接" href="https://www.pikiwidb.com/blog/Pika-3.5.0#%E6%96%B0%E7%89%B9%E6%80%A7">​</a></h2>
<ul>
<li>Pika 支持 Redis 事务，使得 Pika 的数据够在一系列命令的执行中保持数据的一致性和可靠性。 <a href="https://github.com/OpenAtomFoundation/pika/pull/2124" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2124</a></li>
<li>Pika 上层增加缓存层实现冷热数据分离，提升读性能。 <a href="https://github.com/OpenAtomFoundation/pika/pull/2171" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2171</a></li>
<li>Codis-Proxy 支持动态修改配置参数，方便我们做参数调整。 <a href="https://github.com/OpenAtomFoundation/pika/pull/2110" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2110</a></li>
<li>补全 Go Test 测试用例。 <a href="https://github.com/OpenAtomFoundation/pika/pull/2082" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2082</a></li>
<li>CI 增加 cache 提升编译速度。 <a href="https://github.com/OpenAtomFoundation/pika/pull/2093" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2093</a></li>
<li>增加 redis-copy 流量复制工具。 <a href="https://github.com/OpenAtomFoundation/pika/pull/2060" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2060</a></li>
</ul>
<p>bugfix</p>
<ul>
<li>修复 pika 在使用 SETRANGE 命令出现 coredump 的问题。 <a href="https://github.com/OpenAtomFoundation/pika/pull/2141" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2141</a></li>
<li>修复因删除 Clearreplicationid 写进 binlog 导致的全量复制问题。 <a href="https://github.com/OpenAtomFoundation/pika/pull/2135" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2135</a></li>
<li>修改锁粒度，提升 pika 写 binlog 的性能。 <a href="https://github.com/OpenAtomFoundation/pika/pull/2129" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2129</a></li>
<li>修复复杂数据类型成员变量可能出现数据溢出。 <a href="https://github.com/OpenAtomFoundation/pika/pull/2106" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2106</a></li>
<li>修复 decr 命令返回值错误问题。 <a href="https://github.com/OpenAtomFoundation/pika/pull/2092" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2092</a></li>
<li>修复 setrange 和 setbit 命令没有保留原 key 的过期时间的问题。 <a href="https://github.com/OpenAtomFoundation/pika/pull/2095" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2095</a></li>
</ul>
<p>下期版本规划</p>
<p>预计再过两个月左右，我们会在农历新年前发布  3.5.3  版本，相关关键特性有：</p>
<ul>
<li>Pika 通过快慢命令分离提升读写性能。 <a href="https://github.com/OpenAtomFoundation/pika/pull/2162" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2162</a></li>
<li>支持 Redis ACL，在 Pika 中引入用户概念，进行权限控制。 <a href="https://github.com/OpenAtomFoundation/pika/pull/2013" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2013</a></li>
<li>支持 Redis Stream，实现消息队列。 <a href="https://github.com/OpenAtomFoundation/pika/pull/1955" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/1955</a></li>
<li>添加 Pika 特有命令 compactrange，对指定范围内的 key 进行 compact   以解决大 key 删除时读放大的问题。 <a href="https://github.com/OpenAtomFoundation/pika/pull/2163" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2163</a></li>
<li>支持 lastsave 指令。 <a href="https://github.com/OpenAtomFoundation/pika/pull/2167" target="_blank" rel="noopener noreferrer">https://github.com/OpenAtomFoundation/pika/pull/2167</a></li>
</ul>
<p>感谢大家对 Pika 开源公众号的关注 ，Pika 3.5 版本重大特性及使用规范我们会在稍后的文章中进行介绍，我们下期再见～</p>
<p><img decoding="async" loading="lazy" alt="2023-09-28-Pika-3.5.2-connect" src="https://www.pikiwidb.com/assets/images/2023-12-03-Pika-3.5.2-connect-a766680ff0766c42b3506846465fd45b.png" width="747" height="431" class="img_ev3q"></p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Pika Blackwidow 引擎数据存储格式]]></title>
            <link>https://www.pikiwidb.com/blog/pika-blackwidow</link>
            <guid>https://www.pikiwidb.com/blog/pika-blackwidow</guid>
            <pubDate>Thu, 16 Jul 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[Blackwidow本质上是基于rocksdb的封装，使本身只支持kv存储的rocksdb能够支持多种数据结构, 目前Blackwidow支持五种数据结构的存储：String结构(实际上就是存储key, value), Hash结构，List结构，Set结构和ZSet结构， 因为Rocksdb的存储方式只有kv一种， 所以上述五种数据结构最终都要落盘到Rocksdb的kv存储方式上，下面我们展示Blackwidow和rocksdb的关系并且说明我们是如何用kv来模拟多数据结构的。]]></description>
            <content:encoded><![CDATA[<p>Blackwidow本质上是基于rocksdb的封装，使本身只支持kv存储的rocksdb能够支持多种数据结构, 目前Blackwidow支持五种数据结构的存储：String结构(实际上就是存储key, value), Hash结构，List结构，Set结构和ZSet结构， 因为Rocksdb的存储方式只有kv一种， 所以上述五种数据结构最终都要落盘到Rocksdb的kv存储方式上，下面我们展示Blackwidow和rocksdb的关系并且说明我们是如何用kv来模拟多数据结构的。</p>
<p><img decoding="async" loading="lazy" alt="pika-blackwidow-1" src="https://www.pikiwidb.com/assets/images/pika-blackwidow-1-d2f194c46b2f89969b695ca99b666f66.png" width="877" height="1053" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-string结构的存储">1. String结构的存储<a class="hash-link" aria-label="1. String结构的存储的直接链接" title="1. String结构的存储的直接链接" href="https://www.pikiwidb.com/blog/pika-blackwidow#1-string%E7%BB%93%E6%9E%84%E7%9A%84%E5%AD%98%E5%82%A8">​</a></h2>
<p>String本质上就是Key, Value, 我们知道Rocksdb本身就是支持kv存储的， 我们为了实现Redis中的expire功能，所以在value后面添加了4 Bytes用于存储timestamp, 作为最后Rocksdb落盘的kv格式，下面是具体的实现方式:</p>
<p><img decoding="async" loading="lazy" alt="pika-blackwidow-2" src="data:image/png;base64,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" width="750" height="100" class="img_ev3q"></p>
<p>如果我们没有对该String对象设置超时时间，则timestamp存储的值就是默认值0， 否则就是该对象过期时间的时间戳， 每次我们获取一个String对象的时候， 首先会解析Value部分的后四字节， 获取到timestamp做出判断之后再返回结果。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-hash结构的存储">2. Hash结构的存储<a class="hash-link" aria-label="2. Hash结构的存储的直接链接" title="2. Hash结构的存储的直接链接" href="https://www.pikiwidb.com/blog/pika-blackwidow#2-hash%E7%BB%93%E6%9E%84%E7%9A%84%E5%AD%98%E5%82%A8">​</a></h2>
<p>blackwidow中的hash表由两部分构成，元数据(meta_key, meta_value), 和普通数据(data_key, data_value), 元数据中存储的主要是hash表的一些信息， 比如说当前hash表的域的数量以及当前hash表的版本号和过期时间(用做秒删功能), 而普通数据主要就是指的同一个hash表中一一对应的field和value，作为具体最后Rocksdb落盘的kv格式，下面是具体的实现方式:</p>
<ol>
<li>每个hash表的meta_key和meta_value的落盘方式:
<img decoding="async" loading="lazy" alt="pika-blackwidow-3" src="https://www.pikiwidb.com/assets/images/pika-blackwidow-3-e1d6e597bfc0e9f2b5fac3d09de2d347.png" width="750" height="99" class="img_ev3q"></li>
</ol>
<p>meta_key实际上就是hash表的key, 而meta_value由三个部分构成: 4Bytes的Hash size(用于存储当前hash表的大小) + 4Bytes的Version(用于秒删功能) + 4Bytes的Timestamp(用于记录我们给这个Hash表设置的超时时间的时间戳， 默认为0)</p>
<ol start="2">
<li>hash表中data_key和data_value的落盘方式:
<img decoding="async" loading="lazy" alt="pika-blackwidow-4" src="data:image/png;base64,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" width="749" height="100" class="img_ev3q"></li>
</ol>
<p>data_key由四个部分构成: 4Bytes的Key size(用于记录后面追加的key的长度，便与解析) + key的内容 + 4Bytes的Version + Field的内容， 而data_value就是hash表某个field对应的value。</p>
<ol start="3">
<li>如果我们需要查找一个hash表中的某一个field对应的value, 我们首先会获取到meta_value解析出其中的timestamp判断这个hash表是否过期， 如果没有过期， 我们可以拿到其中的version, 然后我们使用key, version，和field拼出data_key, 进而找到对应的data_value（如果存在的话)</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-list结构的存储">3. List结构的存储<a class="hash-link" aria-label="3. List结构的存储的直接链接" title="3. List结构的存储的直接链接" href="https://www.pikiwidb.com/blog/pika-blackwidow#3-list%E7%BB%93%E6%9E%84%E7%9A%84%E5%AD%98%E5%82%A8">​</a></h2>
<p>blackwidow中的list由两部分构成，元数据(meta_key, meta_value), 和普通数据(data_key, data_value), 元数据中存储的主要是list链表的一些信息， 比如说当前list链表结点的的数量以及当前list链表的版本号和过期时间(用做秒删功能), 还有当前list链表的左右边界(由于nemo实现的链表结构被吐槽lrange效率低下，所以这次blackwidow我们底层用数组来模拟链表，这样lrange速度会大大提升，因为结点存储都是有序的), 普通数据实际上就是指的list中每一个结点中的数据，作为具体最后Rocksdb落盘的kv格式，下面是具体的实现方式</p>
<ol>
<li>每个list链表的meta_key和meta_value的落盘方式:
<img decoding="async" loading="lazy" alt="pika-blackwidow-5" src="https://www.pikiwidb.com/assets/images/pika-blackwidow-5-fbecef58859e81229a02ba054c864b53.png" width="749" height="99" class="img_ev3q"></li>
</ol>
<p>meta_key实际上就是list链表的key, 而meta_value由五个部分构成: 8Bytes的List size(用于存储当前链表中总共有多少个结点) + 4Bytes的Version(用于秒删功能) + 4Bytes的Timestamp(用于记录我们给这个List链表设置的超时时间的时间戳， 默认为0) + 8Bytes的Left Index（数组的左边界) + 8Bytes的Right Index(数组的右边界)</p>
<ol start="2">
<li>list链表中data_key和data_value的落盘方式:
<img decoding="async" loading="lazy" alt="pika-blackwidow-6" src="https://www.pikiwidb.com/assets/images/pika-blackwidow-6-fea4db926e09062432073c6c94002b07.png" width="750" height="99" class="img_ev3q"></li>
</ol>
<p>data_key由四个部分构成: 4Bytes的Key size(用于记录后面追加的key的长度，便与解析) + key的内容 + 4Bytes的Version + 8Bytes的Index(这个记录的就是当前结点的在这个list链表中的索引)， 而data_value就是list链表该node中存储的值</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-set结构的存储">4. Set结构的存储<a class="hash-link" aria-label="4. Set结构的存储的直接链接" title="4. Set结构的存储的直接链接" href="https://www.pikiwidb.com/blog/pika-blackwidow#4-set%E7%BB%93%E6%9E%84%E7%9A%84%E5%AD%98%E5%82%A8">​</a></h2>
<p>blackwidow中的set由两部分构成，元数据(meta_key, meta_value), 和普通数据(data_key, data_value), 元数据中存储的主要是set集合的一些信息， 比如说当前set集合member的数量以及当前set集合的版本号和过期时间(用做秒删功能), 普通数据实际上就是指的set集合中的member，作为具体最后Rocksdb落盘的kv格式，下面是具体的实现方式：</p>
<ol>
<li>每个set集合的meta_key和meta_value的落盘方式:
<img decoding="async" loading="lazy" alt="pika-blackwidow-7" src="https://www.pikiwidb.com/assets/images/pika-blackwidow-7-f94a590f52bd9c931f665786bbc12f97.png" width="750" height="100" class="img_ev3q"></li>
</ol>
<p>meta_key实际上就是set集合的key, 而meta_value由三个部分构成: 4Bytes的Set size(用于存储当前Set集合的大小) + 4Bytes的Version(用于秒删功能) + 4Bytes的Timestamp(用于记录我们给这个set集合设置的超时时间的时间戳， 默认为0)</p>
<ol start="2">
<li>set集合中data_key和data_value的落盘方式:
<img decoding="async" loading="lazy" alt="pika-blackwidow-8" src="https://www.pikiwidb.com/assets/images/pika-blackwidow-8-29fc67370188a28f1fc4f5b02c0860b9.png" width="749" height="100" class="img_ev3q"></li>
</ol>
<p>data_key由四个部分构成: 4Bytes的Key size(用于记录后面追加的key的长度，便与解析) + key的内容 + 4Bytes的Version + member的内容， 由于set集合只需要存储member, 所以data_value实际上就是空串</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-zset结构的存储">5. ZSet结构的存储<a class="hash-link" aria-label="5. ZSet结构的存储的直接链接" title="5. ZSet结构的存储的直接链接" href="https://www.pikiwidb.com/blog/pika-blackwidow#5-zset%E7%BB%93%E6%9E%84%E7%9A%84%E5%AD%98%E5%82%A8">​</a></h2>
<p>blackwidow中的zset由两部部分构成，元数据(meta_key, meta_value), 和普通数据(data_key, data_value), 元数据中存储的主要是zset集合的一些信息， 比如说当前zset集合member的数量以及当前zset集合的版本号和过期时间(用做秒删功能), 而普通数据就是指的zset中每个member以及对应的score, 由于zset这种数据结构比较特殊，需要按照memer进行排序，也需要按照score进行排序， 所以我们对于每一个zset我们会按照不同的格式存储两份普通数据, 在这里我们称为member to score和score to member，作为具体最后Rocksdb落盘的kv格式，下面是具体的实现方式：</p>
<ol>
<li>每个zset集合的meta_key和meta_value的落盘方式:
<img decoding="async" loading="lazy" src="https://i.imgur.com/RhZ8KMw.png" alt="" class="img_ev3q"></li>
</ol>
<p>meta_key实际上就是zset集合的key, 而meta_value由三个部分构成: 4Bytes的ZSet size(用于存储当前zSet集合的大小) + 4Bytes的Version(用于秒删功能) + 4Bytes的Timestamp(用于记录我们给这个Zset集合设置的超时时间的时间戳， 默认为0)</p>
<ol start="2">
<li>每个zset集合的data_key和data_value的落盘方式(member to score):
<img decoding="async" loading="lazy" src="https://i.imgur.com/C85Ba5Z.png" alt="" class="img_ev3q"></li>
</ol>
<p>member to socre的data_key由四个部分构成：4Bytes的Key size(用于记录后面追加的key的长度，便与解析) + key的内容 + 4Bytes的Version + member的内容， data_value中存储的其member对应的score的值，大小为8个字节，由于rocksdb默认是按照字典序进行排列的，所以同一个zset中不同的member就是按照member的字典序来排列的(同一个zset的key size, key, 以及version，也就是前缀都是一致的，不同的只有末端的member).</p>
<ol start="3">
<li>每个zset集合的data_key和data_value的落盘方式(score to member):
<img decoding="async" loading="lazy" src="https://i.imgur.com/QV9XHEk.png" alt="" class="img_ev3q"></li>
</ol>
<p>score to member的data_key由五个部分构成：4Bytes的Key size(用于记录后面追加的key的长度，便与解析) + key的内容 + 4Bytes的Version + 8Bytes的Score + member的内容， 由于score和member都已经放在data_key中进行存储了所以data_value就是一个空串，无需存储其他内容了，对于score to member中的data_key我们自己实现了rocksdb的comparator，同一个zset中score to member的data_key会首先按照score来排序， 在score相同的情况下再按照member来排序</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="blackwidow相对于nemo有哪些优势">Blackwidow相对于Nemo有哪些优势<a class="hash-link" aria-label="Blackwidow相对于Nemo有哪些优势的直接链接" title="Blackwidow相对于Nemo有哪些优势的直接链接" href="https://www.pikiwidb.com/blog/pika-blackwidow#blackwidow%E7%9B%B8%E5%AF%B9%E4%BA%8Enemo%E6%9C%89%E5%93%AA%E4%BA%9B%E4%BC%98%E5%8A%BF">​</a></h2>
<ol>
<li>Blackwidow采用了rocksdb的column families的新特性，将元数据和实际数据分开存放(对应于上面的meta数据和data数据), 这种存储方式相对于Nemo将meta, data混在一起存放更加合理， 并且可以提升查找效率(比如info keyspace的效率会大大提升)</li>
<li>Blackwidow中参数传递大量采用Slice而Nemo中采用的是std::string, 所以Nemo会有很多没有必要的string对象的构造函数以及析构函数的调用，造成额外的资源消耗，而Blackwidow则不会有这个问题</li>
<li>Blackwidow对kv模拟多数据结构的存储格式上做了重新设计(具体可以参考Nemo引擎数据存储格式和本篇文章)，使之前在Nemo上出现的一些无法解决的性能问题得以解决，所以Blackwidow的多数据结构在某些场景下性能远远优于Nemo</li>
<li>原来Nemo对多数据结构的Key的长度最大只能支持到256 Bytes，而Blackwidow经过重新设计，放开了多数据结构Key长度的这个限制</li>
<li>Blackwidow相对于Nemo更加节省空间，Nemo由于需要nemo-rocksdb的支持，所以不管在meta还是data数据部分都追加了version和timestamp这些信息，并且为了区分meta_key和data_key, 在最前面加入s和S(拿Set数据结构打比方)，Blackwidow在这方面做了优化，使同样的数据量下Blackwidow所占用的空间比Nemo要小(举个例子，Blackwidow中List结构中的一个Node就比Nemo中的一个Node节省了16 Bytes的空间)</li>
<li>Blackwidow在锁的实现上参照了RocksDB事务里锁的实现方法，而弃用了之前Nemo的行锁，所以在多线程对同一把锁有抢占的情况下性能会有所提升</li>
</ol>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[pika_port 迁移工具]]></title>
            <link>https://www.pikiwidb.com/blog/Pika-Tools-Port-Bin</link>
            <guid>https://www.pikiwidb.com/blog/Pika-Tools-Port-Bin</guid>
            <pubDate>Sun, 26 Apr 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[项目作者：]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="项目作者">项目作者：<a class="hash-link" aria-label="项目作者：的直接链接" title="项目作者：的直接链接" href="https://www.pikiwidb.com/blog/Pika-Tools-Port-Bin#%E9%A1%B9%E7%9B%AE%E4%BD%9C%E8%80%85">​</a></h2>
<p><a href="https://github.com/alexstocks" target="_blank" rel="noopener noreferrer">AlexStocks</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="适用版本">适用版本：<a class="hash-link" aria-label="适用版本：的直接链接" title="适用版本：的直接链接" href="https://www.pikiwidb.com/blog/Pika-Tools-Port-Bin#%E9%80%82%E7%94%A8%E7%89%88%E6%9C%AC">​</a></h2>
<p>3.1 和 2.x</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="项目地址">项目地址：<a class="hash-link" aria-label="项目地址：的直接链接" title="项目地址：的直接链接" href="https://www.pikiwidb.com/blog/Pika-Tools-Port-Bin#%E9%A1%B9%E7%9B%AE%E5%9C%B0%E5%9D%80">​</a></h2>
<p><a href="https://github.com/ipixiu/pika-tools" target="_blank" rel="noopener noreferrer">https://github.com/ipixiu/pika-tools</a></p>
<p><a href="https://github.com/Axlgrep/pika-tools" target="_blank" rel="noopener noreferrer">https://github.com/Axlgrep/pika-tools 长期维护地址需自行编译</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="二进制包">二进制包：<a class="hash-link" aria-label="二进制包：的直接链接" title="二进制包：的直接链接" href="https://www.pikiwidb.com/blog/Pika-Tools-Port-Bin#%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85">​</a></h2>
<p><a href="https://github.com/ipixiu/pika-port-bin" target="_blank" rel="noopener noreferrer">https://github.com/ipixiu/pika-port-bin</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="功能">功能：<a class="hash-link" aria-label="功能：的直接链接" title="功能：的直接链接" href="https://www.pikiwidb.com/blog/Pika-Tools-Port-Bin#%E5%8A%9F%E8%83%BD">​</a></h2>
<p>将Pika中的数据在线迁移到Pika、Redis（支持全量、增量同步）</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="开发背景">开发背景：<a class="hash-link" aria-label="开发背景：的直接链接" title="开发背景：的直接链接" href="https://www.pikiwidb.com/blog/Pika-Tools-Port-Bin#%E5%BC%80%E5%8F%91%E8%83%8C%E6%99%AF">​</a></h2>
<p>之前Pika项目官方提供的pika_to_redis工具仅支持离线将Pika的DB中的数据迁移到Pika、Redis, 且无法增量同步，该工具可以直接伪装为一个Pika的从库，将主库数据通过同步获取并转发给Pika、Redis，同时并支持增量同步</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="实现">实现：<a class="hash-link" aria-label="实现：的直接链接" title="实现：的直接链接" href="https://www.pikiwidb.com/blog/Pika-Tools-Port-Bin#%E5%AE%9E%E7%8E%B0">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="trysync线程">trysync线程<a class="hash-link" aria-label="trysync线程的直接链接" title="trysync线程的直接链接" href="https://www.pikiwidb.com/blog/Pika-Tools-Port-Bin#trysync%E7%BA%BF%E7%A8%8B">​</a></h3>
<ol>
<li>尝试与主库建立同步关系</li>
<li>如果需要全同步，则在接收到master的db之后，启动migrator和sender线程将db里面的数据发送给Pika、Redis</li>
<li>启动Slaveping线程定期给主库发送心跳，完成建立主从关系</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="binlog_receiver线程">binlog_receiver线程<a class="hash-link" aria-label="binlog_receiver线程的直接链接" title="binlog_receiver线程的直接链接" href="https://www.pikiwidb.com/blog/Pika-Tools-Port-Bin#binlog_receiver%E7%BA%BF%E7%A8%8B">​</a></h3>
<ol>
<li>接收主库发送过来的binlog并且将其解析成redis命令</li>
<li>将redis命令转发给Pika、Redis</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="migrator线程">migrator线程<a class="hash-link" aria-label="migrator线程的直接链接" title="migrator线程的直接链接" href="https://www.pikiwidb.com/blog/Pika-Tools-Port-Bin#migrator%E7%BA%BF%E7%A8%8B">​</a></h3>
<ol>
<li>扫描不同数据类型的分库</li>
<li>将key进行解析成响应数据Pika、redis指令</li>
<li>将解析好的redis指令加载到sender的发送buf中</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sender线程">sender线程<a class="hash-link" aria-label="sender线程的直接链接" title="sender线程的直接链接" href="https://www.pikiwidb.com/blog/Pika-Tools-Port-Bin#sender%E7%BA%BF%E7%A8%8B">​</a></h3>
<ol>
<li>从发送buf中读取数据，以非阻塞方式向Pika、redis发送数据</li>
<li>接收Pika、redis返回的结果并解析，如果出现错误则显示错误结果</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="使用帮助">使用帮助：<a class="hash-link" aria-label="使用帮助：的直接链接" title="使用帮助：的直接链接" href="https://www.pikiwidb.com/blog/Pika-Tools-Port-Bin#%E4%BD%BF%E7%94%A8%E5%B8%AE%E5%8A%A9">​</a></h2>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Usage: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       pika_port [-h] [-t local_ip -p local_port -i master_ip -o master_port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  -m forward_ip -n forward_port -x forward_thread_num -y forward_passwd]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  -f filenum -s offset -w password -r rsync_dump_path  -l log_path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -h     -- show this help</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -t     -- local host ip(OPTIONAL default: 127.0.0.1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -p     -- local port(OPTIONAL)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -i     -- master ip(OPTIONAL default: 127.0.0.1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -o     -- master port(REQUIRED)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -m     -- forward ip(OPTIONAL default: 127.0.0.1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -n     -- forward port(REQUIRED)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -x     -- forward thread num(OPTIONAL default: 1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -y     -- forward password(OPTIONAL)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -f     -- binlog filenum(OPTIONAL default: local offset)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -s     -- binlog offset(OPTIONAL default: local offset)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -w     -- password for master(OPTIONAL)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -r     -- rsync dump data path(OPTIONAL default: ./rsync_dump)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -l     -- local log path(OPTIONAL default: ./log)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -b     -- max batch number when port rsync dump data (OPTIONAL default: 512)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -d     -- daemonize(OPTIONAL)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  example: ./pika_port -t 127.0.0.1 -p 12345 -i 127.0.0.1 -o 9221 -m 127.0.0.1 -n 6379 -x 7 -f 0 -s 0 -w abc -l ./log -r ./rsync_dump -b 512 -d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
        </item>
    </channel>
</rss>